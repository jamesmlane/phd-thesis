\section{The tools of galactic archaeology}

In this section the tools required to engage in the study of galactic archaeology and Milky Way formation and evolution are introduced. First is galactic dynamics, which includes the description of orbits as well as the various integrals of motion and kinematic quantities which are useful for characterizing them. Then distribution functions (DFs) are covered, and specifically those used in this thesis. Next is an overview of some aspects of galactic chemical evolution and stellar abundances. Finally, we will touch on N-body techniques and major simulation suites, as well as some key results that rely on them. 

\subsection{The mathematical framework for galactic dynamics}

Here we delve into the mathematical framework which forms the basis for our understanding of the Galaxy. The standard reference for these materials is the textbook \textcite{binney08}, which will be generally followed here. First, orbits and the use of integrals of motion to describe them are introduced. Then DFs, which are the primary model of stellar kinematics in the Milky Way, are covered. These tools will be used throughout the thesis to describe the Milky Way, and to interpret \textit{Gaia} data.

\subsubsection{Orbits and integrals of motion}

Among the many properties of a star, and of chief importance, is the nature of its orbit. The orbit of a star determines which part of the galaxy it exists in, and informs its past and present properties. In many ways galaxies can be thought of as being `built' out of orbits, a perspective which underpins many dynamical modelling approaches. Families of orbits intertwine to create the great stellar populations of the galaxy: the disk, bulge, and halo. While also defined by their unique chemistry and stellar ages, these populations are often most readily separated on the basis of the orbits of their constituent stars. It is with this in mind that here we focus on a framework for describing and labelling stellar orbits. These descriptions will also end up providing the ingredients to construct DFs, which will be the subject of the next section.

The orbit of a star is dictated by the gravitational potential of the galaxy along with the position and velocity of the star at any given time. As these quantities are liable to vary throughout the orbit of a star, it is useful to instead turn to integrals of motion to describe orbits. These are quantities which are conserved along the orbit of a star, and so can be used as a unique set of labels for the orbit under consideration. The number of integrals of motion possessed by an orbit is determined by the nature of the potential. In the case of a spherically symmetric potential, four integrals of motion exist. First is the energy, given by 

\begin{equation}
    \label{ch1:eq:energy}
    E = \frac{1}{2}v^2 + \Phi(\mathbf{r}),
\end{equation}

\noindent where $v$ is the magnitude of the velocity, and $\Phi(r)$ is the gravitational potential, only a function of the spherical radius $r$. The other three integrals of motion are the components of the angular momentum, given in vector form by

\begin{equation}
    \label{ch1:eq:angular-momentum}
    \mathbf{L} = \mathbf{r} \times \mathbf{v}\,,
\end{equation}

\noindent where $\mathbf{r}$ is the position vector and $\mathbf{v}$ is the velocity vector. The most useful among these angular momenta is the z-component, since it is also conserved for axisymmetric potentials. In cylindrical coordinates the z-component of the angular momentum is given by

\begin{equation}
    \label{ch1:eq:z-angular-momentum}
    L_\mathrm{z} = R \, v_{T}\,,
\end{equation}

\noindent where $R$ is the cylindrical radius and $v_{T}$ the tangential velocity. These four integrals of motion are sufficient to describe all the unique orbits in a spherically symmetric potential.

But most galaxies, including the Milky Way and other spiral galaxies, do not have spherically symmetric potentials, and are instead better considered to be flattened or axisymmetric potentials. Such potentials typically permit three integrals of motion: the energy, the z-component of the angular momentum (assuming the potential is symmetric about the z-axis), and a quantity known as the `third integral'. This third integral reflects the conservation of a unique combination of vertical and radial motions beyond the motions described simply by the conservation of energy and z-axis angular momentum (in other words two orbits may share $E$ and $L_{z}$ yet have different phase space trajectories). The conservation of a third integral is only guaranteed in axisymmetric potentials when the radial and vertical components of the potential are separable, but has been empirically established for many realistic potentials \parencite{ollongren62}. Among the many consequences of the conservation of third integral, a notable example can be seen when examining the trace of an orbit in the cylindrical $R-z$ plane, where the orbit will be confined to a characteristic area which is symmetric about the $z=0$ line \parencite[see figure 3.4 in][]{binney08}. The fact that the orbit is confined to this area, which is actually a toroidal volume in 3D space, is a reflection of the conservation of the third integral. One problem with the use of the third integral is that closed form expressions for it are limited to a few special potentials, such as the St\"{a}ckel potential \parencite{dezeeuw85,dejonghe88}, which possesses a number of remarkable properties including that it is separable, and so it is often not computed directly.

As potentials become more complicated the number of integrals of motion either decreases or they become more challenging to compute. Many such potentials are nonetheless important to consider in the context of the Milky Way. Good examples are rotating potentials, such as those representing the Galactic bar, or triaxial potentials which are often used to model the dark matter halo. In some of these instances, such as for the dark halo potential, it is often sufficient to consider the potential to be of a simpler form, such as axisymmetric or spherical. For the Galactic bar, advanced techniques are available that allow computation of conserved quantities in rotating frames of reference. More complicated time-varying behaviour or potentials that deviate significantly from axisymmetry generally require substantial simplifying assumptions to work with. A good example of such a potential that must be considered is the infalling Large Magellanic Cloud, which is currently merging with the Milky Way, and has been shown to have a significant impact on the dynamics of mid- and outer-halo stars and stellar structures \parencite[e.g.][]{erkal19}. In this instance perturbative techniques can be employed to handle the dynamical impact caused by the infalling satellite, but again we will defer discussion of these techniques. To summarize, as potentials deviate from time-indepent axisymmetry the accessibility of integrals of motion decreases and nearly always it is necessary to make simplifying assumptions to proceed. Throughout this thesis potentials will generally be simplified in order to access integrals of motion for analysis and to use as ingredients in DFs, and within each subsequent chapter will be relevant discussions of the implications of such choices where pertinent.

\subsubsection{Action-angle coordinates}

Within the framework of Hamiltonian mechanics, the equations of motion for an orbit are cast in terms of a canonical set of momenta and the corresponding conjugate coordinates. A particularly useful set of such canonical momenta are known as actions, $J_{i}$, and their behaviour is governed by Hamilton's equations, which also involve the Hamiltonian, $H$, and the aforementioned conjugate coordinates $\theta_{i}$. Hamilton's equations take the form

\begin{equation}
    \label{ch1:eq:hamiltons-equations}
\begin{split}
    \dot{J_{i}}= & -\frac{\partial H}{\theta_{i}} \\
    \dot{\theta_{i}} = & \frac{\partial H}{J_{i}}\,.
\end{split}
\end{equation}

 Because the actions are integrals of motion, they are necessarily constant in time, and so the first of these equations is satisfied when the Hamiltonian does not depend on $\theta_{i}$. The second equation yields simple linear time evolution for each of the angles $\theta_{i}$ 

\begin{equation}
    \label{ch1:eq:angle-evolution}
    \theta_{i}(t) = \theta_{i}(0) + \Omega_{i}t\,,
\end{equation}

\noindent involving a quantity $\Omega_{i} = \dot{\theta_{i}}$. Grounding ourselves in the reality that orbits are periodic we interpret these equations as those governing periodic motion. Therefore $\theta_{i}$ are akin to the phase of an orbit along its periodic trajectory, which may increase linearly without bound and yet only be relevant when considered modulo $2\pi$. Building on this we interpret the $\Omega_{i}$ as frequencies of this periodic motion. This equivalence is what gives rise to the standard names for these coordinates: action-angle variables, and their associated frequencies. It is standard to consider the three actions in cylindrical coordinates: $\{J_{R}, J_{\phi}, J_{z}\}$, and their associated angles $\{\theta_{R}, \theta_{\phi}, \theta_{z}\}$. It turns out that the actions are best defined using Poincar\'{e} invariants, which may be cast as line integrals along an orbit trajectory~$\gamma$ 

\begin{equation}
    \label{ch1:eq:actions}
    J_{i} = \frac{1}{2\pi}\oint_{\gamma} p_{i}\, \mathrm{d}q_{i}\,,
\end{equation}

\noindent where $p_{i}$ and $q_{i}$ are components of the position and momentum in cylindrical coordinates. This form of the actions is useful for developing deeper intuition about their nature. As orbits explore a greater range of the configuration space $q_{i}$ (i.e. they orbit farther above and below the Galactic plane, or over a larger radial extent) at higher velocities $p_{i}$ the actions correspondingly increase. While equation~\eqref{ch1:eq:actions} is simple, the actual computation of actions using this equation or other methods can be challenging.

The actions only have closed form solutions for a few special potentials (again, St\"{a}ckel potentials are an example) which in practice are used as approximations for real potentials, or as a part of toy models. So the actions are nearly always computed using numerical techniques. In all cases the azimuthal action $J_{\phi} = L_\mathrm{z}$ is trivial, and only $J_{R}$ and $J_{z}$ require computation. Here will be outlined a few of the most commonly used methods. The first is the spherical approximation, where we can directly draw on equation~\ref{ch1:eq:actions} to determine the actions. $J_{z} = L - L_{z}$ simply becomes the angular momentum net of the azimuthal component, and $J_{R}$ takes a slightly more complicated form involving an integral over the potential between the pericenter and apocenter. This spherical approximation is obviously suitable for spherical potentials, but also has applications as a starting point in axisymmetric potentials as well. Another approach is to employ the adiabatic approximation, which is similar to the epicycle approximation, and assume that the vertical motion above and below the disk may be decoupled from the radial motion towards and away from the Galactic center. Given this both a vertical and radial potential may be constructed and equation~\ref{ch1:eq:actions} used to compute the respective actions. This approach is reasonable for orbits which do not stray too far from the disk and which are not particularly eccentric, and is therefore well-suited for thin-disk orbits in the Milky Way.

The final approach---which is most favoured in modern galactic dynamics---is to model the underlying potential as a St\"{a}ckel potential \parencite{binney12}, which has already been highlighted for its useful properties. Such an approximation implies that the potential is separable in confocal ellipsoidal coordinates $(u,v)$. This unusual choice of coordinate system is driven by observations of the cross-sections of orbits in the $R-z$ plane, which often appear to have boundaries approximately defined by lines of constant $u$ and $v$ \parencite[see figure 3.27 in ][]{binney08}. Therefore converting from cylindrical to prolate confocal coordinates gives a potential in which the $u$ and $v$ motions separate, and then an analog of equation~\eqref{ch1:eq:actions} may be used to compute the actions. This approach is particularly useful in the Milky Way as, in theory, it can reliably produce actions for a wide range of orbits, including those which venture far from the disk plane, and those on eccentric orbits. This is the approach primarily used in this thesis and the specifics will be discussed in greater detail in the relevant chapters.

Actions and other integrals of motion introduced here represent orbits in the most fundamental manner, and are the core pieces of data used in Galactic astrophysics to study and model the various stellar populations of the Milky Way. Next we will cover DFs, the fundamental model for the distribution of phase space kinematics in realistic stellar populations, and which rely a great deal on these actions and integrals of motion.

\subsubsection{Distribution functions}

At a base level the DF is an expression of density in 6-dimensional phase space. When appropriately normalized, the integral of a DF $f$ over all space and all velocities is a constant related to the mass of the system

\begin{equation}
    \label{ch1:eq:df-normalization}
    M = \iint \mathrm{d}^3\mathbf{\mathrm{x}}\, \mathrm{d}^3\mathbf{\mathrm{v}}\, f( \mathbf{\mathrm{x}}, \mathbf{\mathrm{v}}) \,.
\end{equation}

\noindent Since DFs can describe both the positions and motions of stars in a probabilistic sense they are the natural tool for modelling discrete populations of stars in the Milky Way. The challenge is to construct DF models which are both physically motivated and which can be used to fit, study, and interpret the data.

As a starting point we consider a spherical stellar system. As is standard when studying DFs we work in terms of relative energies. The relative potential energy $\Psi$ is defined as 

\begin{equation}
    \label{ch1:eq:relative-potential-energy}
    \Psi = -\Phi + \Phi(\infty)\,,
\end{equation}

\noindent which is simply the negative of the standard gravitational potential offset such that the potential is zero at infinity. The relative energy $\mathcal{E}$ is then given by

\begin{equation}
    \label{ch1:eq:relative-energy}
    \mathcal{E} = \Psi - \frac{v^{2}}{2}\,,
\end{equation}

\noindent where $v$ is the magnitude of the velocity. Now, beginning with the simplest \textit{ansatz} that $f$ is a function only of $\mathcal{E}$, we can write the density of the system as an integral of the DF $f(\mathcal{E})$ over all velocities. If we work in spherical coordinates then the integral can be cast as 

\begin{equation}
    \label{ch1:eq:spherical-df-density}
    \nu(r) = 4\pi \int \mathrm{d} v \, v^{2} \, f(\mathcal{E}) = 4\pi \int \mathrm{d} \, \mathcal{E} \, f(\mathcal{E}) \, \sqrt{ 2(\Psi - \mathcal{E}) }\,.
\end{equation}

\noindent Then if we consider that we may cast the density as a function of $\Psi$ instead of $r$, recognize that the appropriate integration range of $\mathcal{E}$ is 0 to $\Psi$ (equivalent to integrating velocity from 0 to the escape velocity), and then differentiate with respect to $\Psi$ we arrive at the following expression

\begin{equation}
    \label{ch1:eq:spherical-df-density-derivative}
    \frac{1}{\sqrt{8}\pi} \frac{\mathrm{d} \nu}{\mathrm{d} \Psi} =  \int \mathrm{d} \mathcal{E} \, \frac{ f(\mathcal{E}) }{ \sqrt{\Psi - \mathcal{E}} }\,.
\end{equation}

\noindent This is an Abel integral equation which can be solved to yield a solution for the DF of the form

\begin{equation}
    \label{ch1:eq:eddington-inversion-df}
    f(\mathcal{E}) = \frac{1}{\sqrt{8}\pi^2} \left[ \int \frac{\mathrm{d} \Psi}{\sqrt{\Psi - \mathcal{E}}} \frac{\mathrm{d}^{2} \Psi}{\mathrm{d}\nu^{2}} \frac{1}{\sqrt{\mathcal{E}}} \left( \frac{\mathrm{d} \nu}{\mathrm{d} \Psi} \right)_{\Psi = 0} \right] \,.
\end{equation}

This inversion was first discovered by \textcite{eddington16}, and the DFs which it describes---those based solely on energy---are known as ergodic DFs. It is noteworthy to point out that the density $\nu$ and the potential $\Psi$ could be potential-density pairs, or they could be independent. $\nu$ expresses the density of the tracer, the constituent stars of the stellar population under consideration for example. $\Psi$ expresses the gravitational potential governing the dynamics of the tracer population, which could be sourced from $\nu$ for a self-gravitating system like a globular cluster or could be independent such as the way in which the dark halo largely governs the dynamics of the stellar halo. The Eddington DF has a closed-form solution for a number of self-gravitating systems, including the widely used \textcite{hernquist90} potential among others. In general however, and especially when $\nu$ and $\Psi$ are not a potential-density pair, the Eddington inversion must be computed using numerical methods.

A DF, or a stellar population in general, may be described by its orbital anisotropy, $\beta$. The anisotropy of a stellar population is a measure of the degree to which the constituent orbits are preferentially radial, tangential, or neither. Its form, while not intuitive, has its roots in the spherical Jeans equation and is given by 

\begin{equation}
    \label{ch1:eq:anisotropy}
    \beta = 1 - \frac{\sigma_{\theta}^{2} + \sigma_{\phi}^{2}}{2\sigma_{r}^{2}}\,,
\end{equation}

\noindent where $\sigma_{[\theta, \phi, r]}$ are the velocity dispersions in spherical coordinates. The anisotropy has the domain $(-\infty,1]$ such that as $\beta$ approaches negative infinity the orbits become completely tangential, and as $\beta$ approaches 1 the orbits become completely radial. When $\beta=0$ the system is ergodic, and the orbits are isotropic or unbiased. Anisotropy is useful in the context of DFs since two stellar populations may share the same density profile and underlying potential, yet have different anisotropies reflecting different underlying kinematics. 

To construct DFs with variable anisotropy we use angular momentum, another integral of motion, as a second variable. Angular momentum is a natural choice for the purpose of varying the anisotropy since an orbit with a given energy has a maximum angular momentum when it is on a circular orbit, and its angular momentum decreases as it becomes more radial. The DF for a spherical system with constant anisotropy as a function of radius is

\begin{equation}
    \label{ch1:eq:constant-anisotropy-df}
    f(\mathcal{E}, L) = f_{1}(\mathcal{E}) L^{-2\beta}\,,
\end{equation}

\noindent where $f_{1}(\mathcal{E})$ is a function depending only on energy. The approach to solve for $f_{1}$ is similar in spirit to the approach used to create the Eddington inversion, albeit more complicated since the addition of angular momentum complicates the handling of the integral over velocity space. The end result is an integral equation of the form

\begin{equation}
    % \label{eq:AbelIntegral}
    \frac{ 2^{\beta-1/2} }{ 2\pi I_{\beta} } r^{2\beta}\nu = \int_{0}^{\Psi} \mathrm{d}\mathcal{E} \frac{ f_{1}(\mathcal{E}) }{ (\Psi-\mathcal{E})^{\beta-1/2} }\,.
\end{equation}
    
\noindent where $I_{\beta}$ is a constant given by

\begin{equation}
    I_{\beta} = \sqrt{\pi}\frac{\Gamma(1-\beta)}{\Gamma(3/2-\beta)}\,,
\end{equation}

\noindent with $\Gamma$ being the usual Gamma function. This is an Abel integral equation for $1/2 < \beta < 3/2$, giving a solution similar to that found in equation~\eqref{ch1:eq:eddington-inversion-df}. For $\beta < 1/2$ differentiating the integral with respect to $\Psi$ one or more times yields an Abel equation which may be similarly inverted. For certain potential-density pairs such as that of \textcite{hernquist90}, and half-integer values of $\beta$, this equation has a closed-form solution. Otherwise, the DF must be computed numerically, which is often computationally expensive. This presents a challenge when using these types of DFs, since any approach to fitting typically requires computing a likelihood or other objective function multiple times, and the DF would almost definitionally be included in such a function. Much of the work done in this thesis will involve the use of DFs with constant anisotropy and navigating these issues of computability will be a chief driver for certain choices made in the analysis, which will be expounded in subsequent chapters.

An anisotropic DF related to the Eddington DF was introduced independently by \textcite{osipkov79} and \textcite{merritt85}. These authors sought a DF with an anisotropy which increases with radius, which is aligned with galaxy formation theory. The Osipkov-Merritt DF employs a single pseudo-energy defined as 

\begin{equation}
    \label{ch1:eq:osipkov-merritt-pseudo-energy}
    \mathcal{Q} = \mathcal{E} - \frac{L^{2}}{2r_{a}^{2}}\,.
\end{equation}

\noindent where $r_{a}$ is a scale radius. It is possible to cast the integral over all velocities, which has been the starting point for the two previous DFs discussed, in terms of $\mathcal{Q}$, which actually greatly simplifies the resulting integral equation. The result is actually identical to the Eddington inversion, but with $\mathcal{Q}$ substituting for $\mathcal{E}$ and the density multiplied by a factor of $(1 + r^{2}/r_{a}^{2})$, and is therefore approximately equivalent to the Eddington DF in terms of computation strategy. The anisotropy of the Osipkov-Merritt DF varies between $\beta=0$ and $\beta=1$ according to the formula

\begin{equation}
    \label{ch1:eq:osipkov-merritt-anisotropy}
    \beta = \frac{r^{2}}{r^{2} + r_{a}^{2}}\,,
\end{equation}

\noindent and so clearly for $r=r_{a}$ the anisotropy is equal to $1/2$. The Osipkov-Merritt DF is a useful companion to the Eddington and constant-anisotropy DFs, and one chapter of this thesis will be dedicated to comparing these DFs in a practical manner.

A final DF which has grown in popularity over the last decade is based on actions as opposed to energy and angular momentum. First formulated by \textcite{binney14d} and built upon by \textcite{posti15}, DFs of this type have no specifically defined form, but a general structure would be a double power law function of the actions $\mathbf{J} = \{ J_{R}, J_{z}, J_{\phi} \}$ expressed as

\begin{equation}
    \label{ch1:eq:action-df}
    f(\mathbf{J}) = \frac{M}{(2\pi J_{0})^{3}} 
    \bigg[ 1 + \bigg( \frac{J_{0}}{h(\mathbf{J})} \bigg)^{\eta} \bigg]^{\Gamma/\eta} 
    \bigg[ 1 + \bigg( \frac{g(\mathbf{J})}{J_{0}} \bigg)^{\eta} \bigg]^{-B/\eta}
    \bigg[ 1 + \chi \tanh \frac{J_{\phi}}{J_{\phi,0}} \bigg]
    \,.
\end{equation}

\noindent Here, the first term normalizes the DF such that the mass is $M$. The second and third terms control the behaviour of the actions in the small and large regimes respectively (note that smaller and larger actions will roughly correspond to smaller and larger radii) with power law slopes $\Gamma$ and $B$, and a parameter controlling the steepness of the transition $\eta$. The functions $h(\mathbf{J})$ and $g(\mathbf{J})$ control the anisotropy and flattening of the model in the small and large action regimes respectively, and are given by 

\begin{equation}
\label{ch1:eq:action-df-flattening-anisotropy}
\begin{split}
    h(\mathbf{J}) = & h_{r} J_{r} + h_{z} J_{z} + (3-h_{r}-h_{z}) J_{\phi} \\
    g(\mathbf{J}) = & g_{r} J_{r} + g_{z} J_{z} + (3-g_{r}-g_{z}) J_{\phi}\,.
\end{split}
\end{equation}

\noindent The parameters $[h_{r}, h_{z}, g_{r}, g_{z}]$ control the anisotropy and flattening for each regime. The final term of the DF sets the overall sense of rotation about the z-axis by weighting positive or negative values of $J_{\phi}$ with a hyperbolic tangent function, with the degree and scale of the rotation set by $\chi$ and $J_{\phi,0}$ respectively. Additional terms may be constructed and added to this DF which serve to exponentially truncate the model for large actions or to add a core for small actions, see \textcite{binney14d} for more details.

The usefulness of this DF is the fact that it is a direct function of three integrals of motion: the actions. This contrasts with the Eddington family of DFs, which are functions of one or two integrals of motion: energy and sometimes the angular momentum. Since axisymmetric potentials such as the Milky Way admit three integrals (energy, angular momentum, and the third integral), these action-based DFs can theoretically describe more realistic phase space distributions that the Eddington family cannot. Another benefit of action-based DFs is that they have a comparably simple form. But the downside is that, as previously discussed, actions are not typically easy to compute and often require approximations to be made, which contrasts with energy and angular momentum which are always well-defined.

\subsection{Stellar abundances and galactic chemical evolution}

% Introduction
Next we come to a crucial aspect of Milky Way studies: stellar abundances and the broader trends of galactic chemical evolution they encode. Indeed, stellar chemical abundances form the fundamental latticework of galactic archaeology as first described by \textcite{freeman02}. They envisioned using the longest-lived stars, and the (generally) immutable amounts of various elements in their atmospheres as a proxy for their formation environment. Good reviews of stellar abundances, galactic chemical evolution, and related topics include  \textcite{tolstoy09}, \textcite{asplund09}, \textcite{nomoto13}, \textcite{frebel15}, and \textcite{kobayashi23}. Here only the details most relevant to the study of the stellar halo in the \textit{Gaia} era in the context of galaxy formation are presented.

% Stellar atmospheres reflect their birth environment
Stars form through the gravitational collapse of a small region of a molecular cloud, and therefore they are composed, at the most fundamental level, of the chemical elements in the local region of the Universe where they are born, at the time they are born. Barring some notable exceptions, stellar atmospheres are separate from their cores where they fuse light elements into heavy elements, and therefore their atmospheres typically retain the chemical signatures of their birth environment. The measurement of stellar chemical abundances---normally with spectroscopic observations but rough photometric proxies can also be used---then offers a view into the properties of the environment in which the star formed. Not only can a stars birth environments be studied anachronistically in this way, but smaller stellar systems such as globular clusters and dwarf galaxies often have their own distinctive abundance trends reflecting their unique history of chemical evolution. This means that many stars can often be attributed to a single progenitor system according to their common abundance trends, and enables the study of otherwise disrupted stellar systems via clustering. In practice this is often not so easy, but still this approach remains a useful tool used in modern Milky Way studies.

% Abundance trends: sources
While extremely complicated in detail, in broad strokes galactic chemical evolution bears a number of very simple trends that are useful when focusing on galaxy formation. At the dawn of the first galaxies the Universe consisted primarily of Hydrogen and Helium. Stars fuse elements in their core, beginning with these lightest ones, into heavier elements, which can then be returned to the interstellar medium through a variety of mechanisms. Supernovae (SNe) are the most common of these mechanisms, and two classes are relevant for our purposes. Type Ia SNe occur when a degenerate white dwarf star undergoes rapid thermonuclear fusion after crossing the Chandrasekhar limit. Type Ia SNe typically produce large amounts of iron-peak elements such as Fe, Ni, and Mn. Type II SNe occur in a massive star when its degenerate core becomes unstable and collapses. These SNe produce a variety of intermediate- and low-mass elements, most notably the $\alpha$ elements (e.g. O, Mg, Ca) and the odd-Z elements (e.g. Na, Al). The final key source are asymptotic giant branch stars---the penultimate evolutionary stage of a low mass star---which lose mass to the interstellar medium during the thermal pulsations that mark their death and transition to a white dwarf. These stars produce large amounts of C, N, and O, and are also a key source of certain heavy elements produced by the slow neutron capture mechanism.

% Abundance trends: timing
The timing of these different enrichment mechanisms and the differences in elements they produce offer the first useful information we can use. Type II SNe occur on the death of a high-mass star, and therefore happen a few tens of millions of years after star formation. Type Ia SNe, on the other hand, typically occur in a binary white dwarf system and therefore occur on a characteristic timescale of a billion years. Asymptotic giant branch stars likewise contrast to Type II SNe and enrich the interstellar medium many billions of years after star formation. This difference in timescales means that the comparison of a chemical species predominantly produced in Type II SNe with one predominantly produced in Type Ia SNe, for example, is a good proxy for the age of a large stellar population. Stars formed from relatively pristine gas will have elevated amounts of $\alpha$ elements compared with an iron-peak element, since the gas has been enriched by Type II SNe. Stars formed after many generations of enrichment will have lower levels of $\alpha$ elements compared with iron-peak elements, owing to delayed enrichment by Type Ia SNe, as well as higher absolute abundances of iron-peak elements.

% Abundance trends: galaxy size
Chemical enrichment of a galaxy typically occurs over multiple phases of star formation. A generation of stars form and return their enriched constituents to the interstellar medium, often in a very energetic SNe. This can cause both the enriched stellar material and surrounding star-forming gas to be blown out into the hot circumgalactic gas-phase halo or completely expelled from the galaxy all-together. This means that only the most massive galaxies, with their deep potential wells, can be expected to form many generations of stars, with lower mass galaxies being capable of fewer generations, and the lowest mass dwarf spheroidal possibly only allowing for a single round of star formation before expelling and exhausting their supply of gas. So their exists general size-dependent abundance relations that reflect the rate and duration of star formation in the host galaxy, with more massive galaxies enriching substantially more. Furthermore, in $\Lambda$CDM galaxies form inside-out, owing to the settling of gas in the center of the dark matter potential well and subsequent growth from this starting point. A natural result of this is that the inner parts of galaxies experience more rounds of star formation compared with the outer parts, which form later. This means that there will exist abundance gradients in many galaxies, especially large ones like the Milky Way.

% Abundances: combining trends
Together these two sets of trends establish a framework for the use of stellar chemistry to study galactic evolution, focusing particularly on the stellar halo. The standard abundance space for this purpose is the [$\alpha$/Fe] versus [Fe/H] plane \parencite[e.g.][]{hawkins15}. This space is useful because, as outlined above, $\alpha$ elements are mostly provided by Type II SNe, while Fe is mostly produced by Type Ia SNe, which each occur on different timescales. The choice of Fe is driven by its ubiquity and ease of measurement. Good choices of $\alpha$ elements are O and Mg, which are observationally accessible and also primarily produced by Type II SNe. Stellar populations in this space follow characteristic `plateau-knee' trends, whereby at early times (equivalently low-[Fe/H]) the [$\alpha$/Fe] abundance is elevated (the plateau), and then at later times (equivalently higher-[Fe/H]) [$\alpha$/Fe] decreases (the knee) to approximately solar values. Added to this picture is the trend noted above whereby larger galaxies can enrich more aggressively in all abundances, so [Fe/H] will be expected to be higher. Another ingredient that can complicate this picture is that pristine gas can be accreted into the galaxy from less-enriched satellite systems or the broader cosmological reservoir, which will typically decrease the abundances of subsequently formed stars. With all this in mind, a single galaxy like the Milky Way can be thought of as being composed of multiple superimposed plateau-knee [$\alpha$/Fe]-[Fe/H] stellar populations reflecting the remnants of different dwarf galaxies in the halo as well as the radial gradient in historical star formation, and any major additions of pristine gas. An example of the [$\alpha$/Fe] versus [Fe/H] distribution for a sample of metal poor stars from APOGEE \parencite{apogee} will be shown in Figure~\ref{ch1:fig:APOGEEDR17_spatial_abundances}, which will be introduced in a subsequent section but that the reader may want to refer to now.

% Abundances: other trends
Other abundances can be used to complement the [$\alpha$/Fe] versus [Fe/H] plane for the broader study of galactic chemical evolution. C and N are important since their abundances systematically change in red giants experiencing convective dredge up at characteristic point on the red giant branch, and therefore they may be used as mass (equivalently age) proxies for individual stars \parencite[e.g.][]{martig16,mackereth19a}. [Al/Fe] abundances are now commonly used to study \textit{in-situ} and accreted stellar populations, since Al is a metallicity-dependent product of Type II SNe, and therefore the differences in its abundance in large (well-enriched) galaxies like the Milky Way and smaller (less-enriched) dwarfs is particularly stark \parencite[e.g.][]{hawkins15,das20,belokurov22}. [Al/Fe] abundances are often combined with Mg (a nearly pure Type II SNe $\alpha$ element) and Mn (a nearly pure Type Ia SNe iron-peak element) to create the [Al/Fe] versus [Mg/Mn] plane \parencite[e.g.][]{hawkins15,das20,horta21a,fernandez23}. This can be thought of as a variation on the [$\alpha$/Fe] versus [Fe/H] plane described above, but where the [Mg/Mn] abundance traces more purely Type II versus Type Ia SNe enrichment, and [Al/Fe] is a more direct galaxy size indicator. An example of the [Al/Fe] distribution for APOGEE stars will also be shown in Figure~\ref{ch1:fig:APOGEEDR17_spatial_abundances}. Beyond what has been covered here, many other abundances are used to classify individual stars and stellar populations in various parts of the Milky Way in greater detail \parencite[e.g. see][]{frebel15,barbuy18}. 

% Conclusion
To conclude, the chemical composition of stellar atmospheres reflects the history of star formation and enrichment of the gas that formed the stars. For long-lived stars, this gives us a glimpse of historical conditions in and around the Milky Way and other nearby galaxies. The broad themes of galactic chemical evolution can be synthesized into a few useful trends that allow for the quick characterization of stellar populations. It is important to recognize though that the realities of self-consistently modelling these processes rely on detailed treatments of many ingredients, including star-dependent yields of different elements, gas inflow and outflows, and variable star formation rates and histories. Nonetheless, stellar abundances, as revealed by spectroscopic measurements which are becoming increasingly plentiful in the \textit{Gaia} era, are a crucial pillar of the study of the way in which the Milky Way formed and has subsequently evolved.

\subsection{N-body techniques: the theoretical underpinnings of galaxy formation theory}

% Introduction
This section concludes with a look at N-body techniques, which have been a key enabling factor in the development of galaxy formation theory in $\Lambda$CDM \parencite{frenk12}. The use of N-body techniques has dramatically grown in scope and capability over the last half century as compute has become more powerful and widely available. Early use of N-body techniques involved a few hundred particles used to study the stability of galactic disks \parencite[e.g.][]{ostriker73}, and this has grown to fully cosmological simulations of thousands of galaxies using $> 10^{12}$ particles and sophisticated schemes to compute stellar and gas-phase physics \parencite[e.g.][]{eagle_model_crain15,wetzel16,tng_model_pillepich18}. A good review of N-body techniques and their modern use has been given by \textcite{crain23}, and see also \textcite{frenk12}, \textcite{somerville15}, \textcite{bullock17}, and \textcite{wechsler18} for reviews on galaxy and dark matter physics that rely heavily on N-body simulations.

% Important early contributions
While ignited by observations of nearby galaxies, much of our understanding of dark matter has been driven by N-body simulations \parencite{frenk12}. As described in the previous section, key early results have included the dark matter halo power spectrum \parencite{press74}, descriptions of the structure of dark matter halos \parencite{efstathiou88,dubinski91}, and the universality of dark matter halo structure \parencite{navarro96,navarro97}. The nature of dark matter was an ideal scholarly endeavour to pursue with N-body models, since it is challenging to study observationally and the collisionless physics is simple to implement and compute. 

% Simulations of galaxy formation and evolution
Beyond simple gravity-only simulations, N-body techniques are also naturally suited for the study of galaxies. But these types of simulations require somewhat complex subgrid physics models to account for the stellar, gas, and radiative physics which impact baryons in the different forms they take. Baryons must be tracked in the form of gas and stars, with star formation, stellar feedback, and gas inflows and outflows being some of the points at which the two phases intersect and require detailed treatment of the interaction. As opposed to the equations of gravity, for which satisfactory solvers have been available for many decades \parencite[e.g.][]{barnes86}, advancements in subgrid physics models as well as increases in simulation size are the main drivers of improvement in cosmological N-body models today.

% Components of an N-body simulation: HD and gravity solvers
Modern N-body simulations have a number of key ingredients which will be summarized here. Two common frameworks for N-body simulations are particle-based and mesh-based codes, which either represent mass elements and solve for (magneto)hydrodynamic physics using a smoothed-particle scheme or mesh-grid scheme. Subclasses of, and variations on, these algorithms are plentiful and each has its own advantages and disadvantages, the description of which is beyond the remit of this brief introduction. Good examples of particle-based codes are the \texttt{GADGET} family \parencite{gadget2_springel05,gadget4_springel21}, which form the basis of the EAGLE simulations \parencite{schaye15}. An example of a mesh-based code is \texttt{AREPO} \parencite{arepo_springel10}, which forms the basis of the Illustris and IllustrisTNG simulations \parencite{illustris_vogelsberger14,tng_model_pillepich18}. The GIZMO code \parencite{gizmo_hopkins15}, a good example of an alternative approach, uses a mesh-free finiteless mass magnetohydrodynamical solver that can handle more complicated physics than smoothed-particle or mesh-grid schemes. GIZMO forms the basis of the successful FIRE suite of simulations \parencite{wetzel16,FIRE2_model_hopkins18}. The other core component of an N-body code is the gravity solver. Modern N-body codes typically use a tree-based approach to calculate the gravitational force \parencite[e.g.][]{barnes86}, which offers substantial improvements in computability when compared with direct summation. Tree-based gravity solvers allow for nearby mass elements to have their force contribution computed directly while distant mass elements will be grouped to compute an approximate, but satisfactory, distant force contribution.

% Components of an N-body
The initial conditions for cosmological N-body simulations are normally motivated from observations of the CMB such as those by the \textit{Planck} satellite \parencite[][]{planck15}, and take the form of a Gaussian random field \parencite[e.g.][]{efstathiou85}. Related to the initial conditions are the boundary conditions, which are usually periodic such that the long-range gravitational force in each direction is computed using the mass distribution of the simulation volume itself. The final, and perhaps most important, ingredient of an N-body code is the subgrid model. This component handles the physics which cannot be computed numerically using the hydrodynamical or gravity solver, typically that which occurs on scales smaller than the simulation mass resolution. This includes, but is not limited to: many aspects of radiative physics such as gas cooling and heating; star formation and the generation of appropriate stellar populations; feedback from stars, supernovae, or active galactic nuclei; and the tracking and enrichment of elemental abundances. Beyond the hydrodynamics and gravity solvers, these subgrid models are largely what define a suite of N-body simulations, such as the Illustris, FIRE, or EAGLE suites mentioned above. These models are often refined over multiple runs of a simulation (e.g. IllustrisTNG following Illustris, or FIRE2 following FIRE) and calibrated to match key observables such as: the galaxy and halo mass functions, galaxy morphologies, star formation rates, and canonical galaxy scaling relations, among other properties.

% Types of N-body simulations: cosmological and zooms.
These different N-body codes allow for a variety of simulation styles. Most prominent are the large suites of cosmological N-body simulations, including Illustris, FIRE, and EAGLE. These simulations faithfully replicate the physics of galaxy formation and evolution as closely as possible in model universes, and allow for the study of phenomena on scales of dwarf galaxies to galaxy clusters. Their disadvantage, though, is that they are computationally expensive to realize, and their finite mass resolution means that they typically have a resolution limit equivalent to a small- to medium-sized dwarf galaxy (i.e. there are enough particles to meaningfully study them). This makes them somewhat unsuitable for investigating these small stellar systems or the intricate workings of disk galaxies, for example. Another variety of N-body simulations addresses some of these issues by selecting target systems within a cosmological volume and re-simulating them at higher resolution \parencite[i.e. by upsampling the initial conditions, see ][]{bertschinger01,jenkins10}. These `zoom' simulations allow one to study a few galaxies at much finer detail, and explore much smaller scales than would be accessible in fully cosmological simulations. As such, they are particularly important for studying Milky Way analogs, which can be selected in a parent simulation using their well-measured integrated properties. One example of a modern zoom simulation suite is the APOSTLE project \parencite{apostle_sawala16}, which uses the same N-body code as EAGLE to simulate Local Group-like systems (i.e. containing a solitary pair of disk galaxies like the Milky Way and M31) sourced from a dark matter-only cosmological simulation. Another example is the ARTEMIS project \parencite{font20} which also uses the EAGLE code to specifically simulate Milky Way analogs also selected from a dark matter-only simulation. These zoom suites are important in the \textit{Gaia} era where one of the major thrusts of scientific discovery is aimed at determining how some particularly unique or unusual properties of the Milky Way came to be. Zooms allow one to pick out Milky Way-like halos of interest and simulate them at the resolution level needed to answer the questions raised by examinations of the exquisite datasets produced by, and alongside, \textit{Gaia}.

% Types of N-body simulations
A final type of N-body simulation that is worth mentioning are tailor-made simulations. In these projects the initial conditions are not fully cosmological in nature, such as is the case for the simulations outlined above, but they are hand-crafted to investigate a specific scenario. This could involve, for example, creating and simulating a Milky Way-like galaxy as it is accreting a smaller dwarf galaxy. This exact scenario has been explored recently by, for example, \textcite{laporte19} and \textcite{bennett22} to investigate the impact of the infalling Sagittarius dwarf galaxy on the Milky Way stellar disk. The advantage of tailored simulations is that they allow for minute changes to be made to the initial conditions to more directly explore the consequences on the phenomena of interest. Building on the scenario proposed above, one would be able to vary the initial mass, size, and angular momentum of the accreted satellite and examine the remnant deposited in the stellar halo in each case. This approach is the equivalent of a classic controlled experiment in the medical or psychological sciences which is the most reliable experimental design in those fields. This type of study is not as straightforward with cosmological or zoom simulations where these questions could possibly also be addressed, but one relies on cosmic variance to naturally produce a spectrum of phenomena and behaviours related to the question of interest, which obviously offers less predictive power. The downside of tailored simulations is that they are not cosmological in nature, and it is possible to set up initial conditions that would never be observed in the Universe, which can raise skepticism. Nonetheless, they, like cosmological and zoom simulations, are a useful tool in the arsenal of galactic archaeologists interested in the formation and evolution of the Milky Way.